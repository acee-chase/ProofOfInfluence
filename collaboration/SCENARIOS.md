# 协作场景案例

> 实际工作中的典型场景和完整流程

---

## 场景 A: 开发新功能 (标准流程, 40分钟)

### 适用情况
- 添加新的页面或组件
- 实现新的业务功能
- 开发需要 30分钟 - 2小时

### 完整流程

```
┌─────────────────────────────────────────────────────────────┐
│ 第 1 步: 需求规划 (ChatGPT + 人工, 5分钟)                   │
├─────────────────────────────────────────────────────────────┤
│ 人工 → ChatGPT:                                              │
│   "我要添加用户评价轮播功能"                                │
│   "目标用户是 Web2 创作者和投资人"                          │
│   "需要显示头像、姓名、评价内容、职位"                      │
│                                                              │
│ ChatGPT → 人工:                                              │
│   ✅ 组件结构: Testimonials.tsx                              │
│   ✅ 使用技术: Shadcn Card + Embla Carousel                 │
│   ✅ 数据结构: { name, avatar, quote, role }                │
│   ✅ 设计建议: 3列网格，移动端单列                          │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 第 2 步: 代码实现 (Cursor + 人工, 30分钟)                   │
├─────────────────────────────────────────────────────────────┤
│ 人工操作:                                                    │
│   git checkout -b feat/testimonials                          │
│                                                              │
│ 人工 → Cursor Composer (Ctrl+I):                             │
│   "创建 Testimonials.tsx 组件，基于 ChatGPT 的设计"        │
│   "参考 @design_guidelines.md"                               │
│                                                              │
│ Cursor → 代码:                                               │
│   ✅ 生成组件骨架                                            │
│   ✅ 添加 TypeScript 类型                                    │
│   ✅ 集成 Shadcn UI 组件                                     │
│   ✅ 添加响应式样式                                          │
│                                                              │
│ 人工测试:                                                    │
│   npm run dev                                                │
│   访问 http://localhost:5173                                 │
│   ✅ 检查功能是否正常                                        │
│   ✅ 测试移动端和桌面端                                      │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 第 3 步: 代码提交 (人工 + GitHub, 2分钟)                    │
├─────────────────────────────────────────────────────────────┤
│ 人工操作:                                                    │
│   git add .                                                  │
│   git commit -m "feat: add testimonials carousel"           │
│   git push origin feat/testimonials                          │
│                                                              │
│ GitHub:                                                      │
│   ✅ 创建 Pull Request                                       │
│   ✅ 自动填充 PR 模板                                        │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 第 4 步: 代码审查 (人工 + ChatGPT可选, 3分钟)              │
├─────────────────────────────────────────────────────────────┤
│ 人工审查 PR:                                                 │
│   ✅ 检查改动文件列表                                        │
│   ✅ 查看代码 Diff                                           │
│   ✅ 确认符合预期                                            │
│                                                              │
│ 可选 - 人工 → ChatGPT:                                       │
│   "帮我审查这段代码，有没有性能问题？"                      │
│   [粘贴关键代码]                                             │
│                                                              │
│ 人工决策:                                                    │
│   ✅ 点击 "Merge pull request"                               │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 第 5 步: 自动部署 (Replit 自动, 2分钟)                      │
├─────────────────────────────────────────────────────────────┤
│ GitHub → Replit:                                             │
│   ✅ 检测到 main 分支更新                                    │
│   ✅ 触发自动部署                                            │
│                                                              │
│ Replit 自动执行:                                             │
│   ✅ npm run build                                           │
│   ✅ npm start                                               │
│   ✅ 生成部署 URL                                            │
│                                                              │
│ 人工验证:                                                    │
│   ✅ 访问 Replit 部署 URL                                    │
│   ✅ 测试新功能                                              │
│   ✅ 确认生产环境正常                                        │
└─────────────────────────────────────────────────────────────┘

总耗时: 约 40 分钟
```

### 实际案例：Landing 页面重设计

**背景**: 需要重新设计 ProofOfInfluence 的 Landing 页面

**ChatGPT 规划阶段**:
```
人工输入:
"重新设计 Landing 页面，目标用户是 Web2创作者和投资人
核心信息：
1. 影响力证明（数据追踪）
2. 空投资格（钱包连接）
3. 简单易用（一键登录）"

ChatGPT 输出:
- Hero区：动态背景 + 大标题 + 双CTA
- Features区：3列卡片展示核心功能
- Testimonials区：用户评价轮播
- CTA区：底部号召注册
- 组件列表：HeroSection, FeaturesGrid, TestimonialsCarousel
```

**Cursor 开发阶段**:
```bash
git checkout -b feat/landing-redesign

# Cursor Composer (Ctrl+I)
"重新设计 client/src/pages/Landing.tsx
参考 @design_guidelines.md

添加:
1. Hero 区：动态背景 + 大标题 + 双 CTA
2. Features 区：3列卡片展示核心功能
3. Testimonials 区：用户评价轮播
4. CTA 区：底部号召注册

使用 Shadcn UI 组件，保持响应式设计"

npm run dev  # 本地测试
```

**部署验证**:
```bash
git add .
git commit -m "feat: redesign landing page with testimonials and features"
git push origin feat/landing-redesign

# GitHub 创建 PR → 合并
# Replit 自动部署 → 访问生产 URL 验证
```

---

## 场景 B: 快速修复 (简化流程, 5分钟)

### 适用情况
- 修复简单的Bug
- 更新文案或样式
- 小范围代码调整

### 完整流程

```
人工发现问题
    ↓
ChatGPT 诊断 (可选, 如果不确定原因)
    ↓
Cursor 快速修复 (直接在 main 分支)
    ↓
人工本地测试
    ↓
Git 推送 → GitHub → Replit 自动部署
    ↓
人工验证生产环境
```

### 实际案例：修复钱包连接超时

**问题发现**:
```
用户报告：点击"Connect Wallet"后超时
错误信息：Timeout waiting for wallet response
```

**ChatGPT 诊断**:
```
人工输入:
"钱包连接超时，错误信息是 'Timeout waiting for wallet response'
代码如下：
[粘贴 WalletConnectButton.tsx 相关代码]"

ChatGPT 输出:
"问题原因：没有设置超时处理
解决方案：添加 30秒超时和用户友好提示
建议代码：[提供修复代码]"
```

**Cursor 快速修复**:
```bash
# 直接在 main 分支修复
git pull origin main

# Cursor Chat (Ctrl+L) 或手动修改
# 添加超时处理逻辑

npm run dev  # 快速测试

git add client/src/components/WalletConnectButton.tsx
git commit -m "fix: add timeout handling for wallet connection"
git push origin main

# Replit 自动部署 → 验证
```

**总耗时**: 约 5 分钟

---

## 场景 C: 重大重构 (谨慎流程, 2-4小时)

### 适用情况
- 重构核心架构
- 大规模代码改动
- 可能影响多个模块

### 完整流程

```
第 1 步: 详细规划 (ChatGPT + 人工, 30分钟)
  - 明确重构目标和范围
  - 讨论潜在风险和回滚方案
  - 制定分步实施计划

第 2 步: 创建长期分支 (人工)
  git checkout -b refactor/auth-system

第 3 步: 分步实现 (Cursor + 人工, 1-2小时)
  - 每次只改一小部分
  - 频繁提交到分支
  - 持续本地测试

第 4 步: 充分测试 (人工, 30分钟)
  - 测试所有关键流程
  - 测试边界情况
  - 性能测试

第 5 步: 代码审查 (ChatGPT + 人工, 30分钟)
  - ChatGPT 全面审查代码
  - 人工确认符合预期

第 6 步: 分阶段部署
  - 先合并到 dev 分支（如果有）
  - 在 Replit 测试环境验证
  - 确认无误后合并到 main
```

### 实际案例：重构认证系统

**规划阶段**:
```
人工 → ChatGPT:
"当前认证系统使用 Replit Auth，我想添加：
1. JWT token 管理
2. Refresh token 机制
3. 更好的会话管理

需要重构哪些部分？有什么风险？"

ChatGPT 输出:
1. 重构范围：
   - server/replitAuth.ts
   - server/routes.ts (认证中间件)
   - client/hooks/useAuth.ts
   
2. 潜在风险：
   - 现有用户会话失效
   - 需要数据库迁移
   
3. 实施步骤（6步）：
   [详细步骤列表]
   
4. 回滚方案：
   - 保留旧代码分支
   - 数据库备份
```

**分步实施**:
```bash
git checkout -b refactor/auth-jwt

# 第1步：添加 JWT 工具函数（不影响现有功能）
# Cursor 实现 → 测试 → 提交

# 第2步：更新认证中间件（渐进式替换）
# Cursor 实现 → 测试 → 提交

# 第3步：更新前端 hooks
# Cursor 实现 → 测试 → 提交

# ... 每步都独立测试和提交
```

**充分测试**:
```
1. 单元测试所有新函数
2. 测试完整登录流程
3. 测试 token refresh
4. 测试会话过期处理
5. 性能测试（vs 旧系统）
```

**审查部署**:
```
1. ChatGPT 审查全部改动
2. 人工再次测试
3. 创建详细的 PR 说明
4. 合并到 main
5. 密切监控生产环境
```

---

## 场景 D: 紧急修复 (应急流程, < 10分钟)

### 适用情况
- 生产环境严重Bug
- 服务中断
- 数据安全问题

### 应急流程

```bash
# 1. 立即评估影响
# 2. 向 ChatGPT 快速诊断
# 3. Cursor 紧急修复
# 4. 跳过 PR，直接推送 main
# 5. 监控部署
# 6. 事后复盘

# 具体命令
git pull origin main
# Cursor 快速修复
npm run dev  # 快速验证
git add .
git commit -m "hotfix: critical bug causing service outage"
git push origin main
# 立即监控 Replit 部署
# 验证生产环境恢复
```

### 实际案例：数据库连接断开

**问题**: 生产环境无法访问，错误 500

**应急处理**:
```
1. 查看 Replit 日志：数据库连接失败
2. ChatGPT 快速诊断：连接字符串过期
3. 更新 Replit Secrets 中的 DATABASE_URL
4. 手动重启 Replit 服务
5. 验证恢复
6. 记录事故报告
```

**总耗时**: < 10 分钟

---

## 📊 场景对比

| 场景 | 时长 | 分支策略 | 测试程度 | PR流程 |
|------|------|---------|---------|--------|
| 新功能开发 | 40分钟 | feature 分支 | 充分 | 标准PR |
| 快速修复 | 5分钟 | main 分支 | 基本 | 可选 |
| 重大重构 | 2-4小时 | refactor 分支 | 详尽 | 详细PR |
| 紧急修复 | <10分钟 | hotfix/main | 最小 | 跳过 |

---

## 💡 选择场景的判断标准

### 用场景 A（新功能）如果：
- ✅ 需要添加新文件或组件
- ✅ 改动 > 50 行代码
- ✅ 涉及多个文件
- ✅ 需要充分测试

### 用场景 B（快速修复）如果：
- ✅ 只改 1-2 个文件
- ✅ 改动 < 50 行代码
- ✅ 逻辑简单明确
- ✅ 风险低

### 用场景 C（重大重构）如果：
- ✅ 改动核心架构
- ✅ 影响多个模块
- ✅ 需要数据迁移
- ✅ 有重大风险

### 用场景 D（紧急修复）如果：
- ✅ 生产环境中断
- ✅ 严重安全问题
- ✅ 数据丢失风险
- ✅ 用户无法使用

---

## 🎓 最佳实践

### 新功能开发
1. ✅ 充分规划再动手
2. ✅ 小步提交，频繁测试
3. ✅ 移动端和桌面端都要测
4. ✅ 代码审查不能省

### 快速修复
1. ✅ 确认问题范围小
2. ✅ 本地测试必须做
3. ✅ 推送后立即验证
4. ✅ 记录修复内容

### 重大重构
1. ✅ 制定详细计划
2. ✅ 准备回滚方案
3. ✅ 分步实施和测试
4. ✅ 全面代码审查
5. ✅ 密切监控上线

### 紧急修复
1. ✅ 评估影响范围
2. ✅ 快速定位问题
3. ✅ 最小化修改
4. ✅ 部署后持续监控
5. ✅ 事后详细复盘

---

## 📚 相关文档

- [完整协作指南](GUIDE.md) - 详细的角色和流程
- [每日工作清单](DAILY_CHECKLIST.md) - 标准工作流程
- [协作系统概览](README.md) - 快速了解

---

**最后更新**: 2025-11-02  
**适用版本**: v1.0+

